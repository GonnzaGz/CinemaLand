<!-- PeliRandom Page -->
<div class="pelirandom-page">
  <!-- Header Section -->
  <section class="page-header">
    <div class="header-content">
      <a class="btn-back" routerLink="/">
        <i class="fas fa-arrow-left"></i>
        Volver
      </a>

      <h1 class="page-title">
        <i class="fas fa-dice"></i>
        Experiencia Random!
      </h1>

      <div class="promo-badge">
        <i class="fas fa-percentage"></i>
        15% de Descuento
      </div>

      <p class="page-subtitle">
        ¡Disfruta de la Nueva Experiencia de Ir al Cine!
      </p>
    </div>
  </section>

  <!-- Main Content -->
  <section class="main-content">
    <div class="selection-section">
      <!-- Category Selector -->
      <div class="category-selector">
        <h2 class="section-title">
          <i class="fas fa-tags"></i>
          Selecciona tus Géneros
        </h2>

        <div class="categories-grid">
          <div
            *ngFor="let item of categorias; let i = index"
            class="category-item"
            [class.selected]="idcategorias.includes(item.id)"
            (click)="toggleCategory(item)"
          >
            <div class="custom-checkbox">
              <input
                type="checkbox"
                [id]="'category-' + item.id"
                [checked]="idcategorias.includes(item.id)"
                (change)="onCheckboxChange($event, item)"
              />
              <div class="checkbox-visual"></div>
            </div>
            <label [for]="'category-' + item.id" class="category-label">
              {{ item.name }}
            </label>
          </div>
        </div>

        <div class="random-button-container">
          <button
            class="btn-random"
            [class.loading]="loading"
            [disabled]="idcategorias.length === 0 || loading"
            (click)="Randompeli()"
          >
            <i class="fas fa-magic" *ngIf="!loading"></i>
            <div
              class="loading-spinner"
              *ngIf="loading"
              style="width: 20px; height: 20px; border-width: 2px"
            ></div>
            <span *ngIf="!loading">Buscar Random</span>
            <span *ngIf="loading">Buscando...</span>
          </button>
        </div>
      </div>

      <!-- Movie Roulette -->
      <div class="roulette-section">
        <h2 class="section-title">
          <i class="fas fa-film"></i>
          Tu Película Random
        </h2>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="loading-spinner"></div>
          <p class="loading-text">Buscando tu película perfecta...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && peliculas.length === 0" class="empty-state">
          <i class="fas fa-dice"></i>
          <h3>¡Hora de la sorpresa!</h3>
          <p>
            Selecciona algunos géneros y presiona "Buscar Random" para descubrir
            tu próxima película favorita.
          </p>
        </div>

        <!-- Movie Roulette -->
        <div
          *ngIf="!loading && peliculas.length > 0"
          class="roulette-container"
        >
          <div class="movie-roulette">
            <div
              *ngFor="let movie of peliculas; let i = index"
              class="movie-card"
              [class.active]="i === activeIndex"
            >
              <img
                [src]="'https://image.tmdb.org/t/p/w300/' + movie.poster_path"
                [alt]="movie.title"
                class="movie-poster"
                *ngIf="movie.poster_path"
              />
              <div class="movie-poster fallback" *ngIf="!movie.poster_path">
                <i class="fas fa-film"></i>
              </div>

              <div class="movie-info">
                <h3 class="movie-title">{{ movie.title }}</h3>
                <p class="movie-year">
                  {{ movie.release_date | date : "yyyy" }}
                </p>

                <div class="movie-actions">
                  <button
                    class="btn-small btn-details"
                    [routerLink]="['/movie-details', movie.id]"
                  >
                    <i class="fas"></i>
                    Detalles
                  </button>
                  <button
                    class="btn-small btn-tickets"
                    (click)="irAComprarEntradas(movie.id)"
                  >
                    <i class="fas fa-ticket-alt"></i>
                    Entradas
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
