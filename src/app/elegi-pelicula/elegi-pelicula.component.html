<div class="elegi-pelicula-container">
  <!-- Header -->
  <div class="page-header">
    <h1>PELÍCULAS EN CARTELERA</h1>
    <p class="subtitle">
      Descubre todas las películas disponibles en nuestros cines
    </p>
  </div>

  <!-- Filtros -->
  <div class="filtros-container">
    <div class="filtros-row">
      <div class="filtro-grupo">
        <label class="filtro-label">Formato</label>
        <div class="filtro-opciones">
          <button
            class="filtro-btn"
            [class.active]="filtroFormato === 'todos'"
            (click)="setFiltroFormato('todos')"
          >
            Todos
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroFormato === '2D'"
            (click)="setFiltroFormato('2D')"
          >
            2D
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroFormato === '3D'"
            (click)="setFiltroFormato('3D')"
          >
            3D
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroFormato === 'IMAX'"
            (click)="setFiltroFormato('IMAX')"
          >
            IMAX
          </button>
        </div>
      </div>

      <div class="filtro-grupo">
        <label class="filtro-label">Idioma</label>
        <div class="filtro-opciones">
          <button
            class="filtro-btn"
            [class.active]="filtroIdioma === 'todos'"
            (click)="setFiltroIdioma('todos')"
          >
            Todos
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroIdioma === 'español'"
            (click)="setFiltroIdioma('español')"
          >
            Español
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroIdioma === 'ingles'"
            (click)="setFiltroIdioma('ingles')"
          >
            Inglés
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroIdioma === 'subtitulado'"
            (click)="setFiltroIdioma('subtitulado')"
          >
            Subtitulado
          </button>
        </div>
      </div>

      <div class="filtro-grupo">
        <label class="filtro-label">Edad</label>
        <div class="filtro-opciones">
          <button
            class="filtro-btn"
            [class.active]="filtroEdad === 'todos'"
            (click)="setFiltroEdad('todos')"
          >
            Todos
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEdad === 'ATP'"
            (click)="setFiltroEdad('ATP')"
          >
            ATP
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEdad === '+13'"
            (click)="setFiltroEdad('+13')"
          >
            +13
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEdad === '+16'"
            (click)="setFiltroEdad('+16')"
          >
            +16
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEdad === '+18'"
            (click)="setFiltroEdad('+18')"
          >
            +18
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de Películas -->
  <div class="peliculas-grid">
    <div class="grid-container">
      <div
        class="pelicula-card-modern"
        *ngFor="let pelicula of peliculasFiltradas"
        (click)="verDetalles(pelicula.id)"
      >
        <!-- Imagen de la película -->
        <div class="card-image-container">
          <img
            [src]="
              pelicula.poster_path
                ? 'https://image.tmdb.org/t/p/w500' + pelicula.poster_path
                : 'assets/images/no-image.jpg'
            "
            [alt]="pelicula.title"
            class="card-image"
            loading="lazy"
          />

          <!-- Overlay con información -->
          <div class="card-overlay">
            <!-- Rating -->
            <div class="rating-badge">
              <i class="fas fa-star"></i>
              <span>{{
                (pelicula.vote_average | number : "1.1-1") || "N/A"
              }}</span>
            </div>

            <!-- Clasificación de edad -->
            <div class="age-rating">
              {{ pelicula.clasificacionEdad }}
            </div>

            <!-- Botón de favoritos -->
            <button
              class="favorite-btn"
              [class.is-favorite]="esFavorita(pelicula.id)"
              (click)="toggleFavorito(pelicula, $event)"
              [attr.aria-label]="
                esFavorita(pelicula.id)
                  ? 'Quitar de favoritos'
                  : 'Agregar a favoritos'
              "
            >
              <i class="fas fa-heart"></i>
            </button>
          </div>
        </div>

        <!-- Contenido de la card -->
        <div class="card-content">
          <h3 class="movie-title">{{ pelicula.title }}</h3>

          <div class="movie-badges">
            <span class="movie-genre-badge">
              <i class="fas fa-tag"></i>
              {{ pelicula.genre_ids?.length ? "Acción, Drama" : "Película" }}
            </span>
            <span
              class="movie-status-badge estreno"
              *ngIf="pelicula.vote_average > 7.5"
            >
              ESTRENO
            </span>
            <span
              class="movie-status-badge cartelera"
              *ngIf="pelicula.vote_average <= 7.5"
            >
              CARTELERA
            </span>
            <span class="movie-rating-text">
              +{{ pelicula.clasificacionEdad }}
            </span>
          </div>

          <div class="movie-meta">
            <span class="duration">
              <i class="fas fa-clock"></i>
              {{ (pelicula.id % 60) + 90 }} min
            </span>
          </div>

          <p class="movie-description">
            {{
              pelicula.overview?.substring(0, 100) ||
                "Descripción no disponible"
            }}
            <span *ngIf="pelicula.overview && pelicula.overview.length > 100"
              >...</span
            >
          </p>
        </div>

        <!-- Acciones de la card -->
        <div class="card-actions">
          <button
            class="btn-info"
            (click)="verDetalles(pelicula.id); $event.stopPropagation()"
            title="Ver información completa"
          >
            <i class="fas fa-info-circle"></i>
          </button>

          <button
            class="btn-comprar-entradas"
            (click)="comprarEntradas(pelicula.id); $event.stopPropagation()"
          >
            <i class="fas fa-ticket-alt"></i>
            COMPRAR ENTRADAS
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Botón Ver Más -->
  <div class="ver-mas-section" *ngIf="peliculas.length > peliculasMostradas">
    <button class="btn-ver-mas" (click)="verMasPeliculas()">
      {{
        mostrarTodasLasPeliculas ? "Ver Menos Películas" : "Ver Más Películas"
      }}
      <i
        class="fas"
        [class.fa-chevron-down]="!mostrarTodasLasPeliculas"
        [class.fa-chevron-up]="mostrarTodasLasPeliculas"
      ></i>
    </button>
  </div>

  <!-- Mensaje cuando no hay películas -->
  <div class="no-movies" *ngIf="peliculasFiltradas.length === 0">
    <div class="no-movies-content">
      <i class="fas fa-film"></i>
      <h3>No se encontraron películas</h3>
      <p *ngIf="!filtrosAplicados">
        No hay películas disponibles en este momento.
      </p>
      <p *ngIf="filtrosAplicados">
        No hay películas disponibles con los filtros:
        <strong>{{ textoFiltrosAplicados }}</strong>
      </p>
      <button
        class="btn-primary"
        (click)="limpiarFiltros()"
        *ngIf="filtrosAplicados"
      >
        Limpiar Filtros
      </button>
    </div>
  </div>
</div>
